import{c as L,j as e,D as ee,v as se,w as ae,x as te,y as re,B as i,X as U,z as le,A as ie,S as Ie,E as I,s as ue,P as Le,G as qe,H as $e,I as Ve,o as ne,r,t as M,q as W,U as ce,J as K,K as fe,M as ge,u as je,b as X,N as ze,O as ye,Q as Be,R as Oe,T as Je,V as Re,Y as Pe,f as Ne,a as Ue,d as He,Z as Ge,g as $,h as V,i as z,k as B,l as O,L as Z,_ as Ze,$ as Ye,a0 as Qe,a1 as We,a2 as Ke}from"./index-1d87757c.js";import{S as Xe,a as es,b as ss,c as as,d as ts,e as rs,f as ls,g as is}from"./sheet-74228ed3.js";import{b as ns}from"./jobOptions-1997529c.js";import{G as cs}from"./GalleryTab-d1ceb71a.js";import{M as oe}from"./map-pin-b62a81cc.js";import{M as os}from"./mail-8703cb89.js";import{C as ds,P as ms}from"./pen-3edc6ea5.js";import{T as xs,a as J,b as R,c as P}from"./tooltip-d02ea239.js";import{C as ve}from"./calendar-ddbfb0cc.js";import{S as hs}from"./sliders-horizontal-0f7afeec.js";import{T as Y}from"./trash-2-18ebab21.js";import"./textarea-bd3e9a46.js";import"./MediaForm-2d488de0.js";import"./crop-74373485.js";const ps=L("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),us=L("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),fs=L("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),Q=L("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),be=L("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),gs=({applicantProfile:a,application:d,isOpen:v,onClose:x,onAccept:o,onReject:l,isUpdating:h})=>{if(!v||!a)return null;const g=Array(4).fill(null);return e.jsx(ee,{open:v,onOpenChange:x,children:e.jsxs(se,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:[e.jsxs(ae,{className:"p-6 pb-4 border-b sticky top-0 bg-white z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(te,{className:"text-2xl font-bold text-gray-800",children:"Perfil do Candidato"}),e.jsx(re,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"text-gray-500 hover:text-gray-700",children:e.jsx(U,{className:"h-5 w-5"})})})]}),e.jsx(le,{children:"Analise o perfil do modelo e tome uma decisão sobre a candidatura."})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:space-x-6 mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-pink-100 to-purple-100 rounded-full flex items-center justify-center mb-4 sm:mb-0 shadow-md flex-shrink-0",children:a.profile_image_url?e.jsx("img",{src:a.profile_image_url,alt:`Foto de ${a.name}`,className:"w-full h-full object-cover rounded-full"}):e.jsx(ie,{className:"w-16 h-16 text-pink-400"})}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h3",{className:"text-3xl font-bold text-gray-900",children:a.name}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center sm:justify-start gap-x-4 gap-y-1 text-gray-600 mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"h-4 w-4 mr-1.5"}),a.city,", ",a.state]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1.5 text-yellow-400 fill-current"}),Number(a.avg_rating||0).toFixed(1)," (",a.rating_count||0,")"]})]}),e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start gap-2 mt-2",children:[a.is_verified&&e.jsxs(I,{variant:"outline",className:"border-blue-500 text-blue-600",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Verificado"]}),a.subscription_type&&e.jsxs(I,{variant:"outline",className:"border-yellow-500 text-yellow-600",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),a.subscription_type]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Contato"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(os,{className:"h-4 w-4 mr-2 text-gray-400"})," ",a.email]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx(Le,{className:"h-4 w-4 mr-2 text-gray-400"})," ",a.phone||"Não informado"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Detalhes Físicos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Altura:"})," ",a.height||"N/A"," cm"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Peso:"})," ",a.weight||"N/A"," kg"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Cabelo:"})," ",a.hair_color||"N/A"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Olhos:"})," ",a.eye_color||"N/A"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Carta de Apresentação"}),e.jsx("p",{className:"text-sm text-gray-600 italic",children:d.cover_letter||"Nenhuma carta de apresentação foi enviada."})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3 text-lg",children:"Galeria de Fotos"}),e.jsx(cs,{photos:g,profileName:a.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Galeria de exemplo. A galeria real será implementada em seguida."})]})]}),e.jsxs(qe,{className:"p-6 border-t sticky bottom-0 bg-white z-10 flex flex-col sm:flex-row justify-end gap-2",children:[e.jsxs(i,{variant:"outline",onClick:x,disabled:h,children:[e.jsx($e,{className:"h-4 w-4 mr-2"})," Voltar para Lista"]}),d.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"destructive",onClick:()=>l(d.id),disabled:h,className:"w-full sm:w-auto",children:[e.jsx(U,{className:"h-4 w-4 mr-2"})," Recusar"]}),e.jsxs(i,{onClick:()=>o(d.id),disabled:h,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"})," Aceitar Candidatura"]})]})]})]})})},js=({job:a,isOpen:d,onClose:v,onNavigate:x})=>{const{toast:o}=ne(),[l,h]=r.useState([]),[g,p]=r.useState(!0),[b,y]=r.useState(null),[w,C]=r.useState(!1),[N,_]=r.useState(null),k=r.useCallback(async()=>{if(!a){p(!1);return}p(!0);try{const{data:t,error:m}=await M.from("job_applications").select(`
          *,
          profiles ( * )
        `).eq("job_id",a.id).order("application_date",{ascending:!0});if(m)throw m;h(t||[])}catch(t){o({title:"Erro ao buscar candidatos",description:t.message,variant:"destructive"})}finally{p(!1)}},[a,o]);r.useEffect(()=>{d&&!w&&k()},[d,w,k]);const A=async(t,m)=>{y(t);try{const{error:f}=await M.from("job_applications").update({status:m}).eq("id",t);if(f)throw f;o({title:"Status da candidatura atualizado!",description:`O candidato foi ${m==="accepted"?"aceito":"recusado"}.`}),C(!1),k()}catch(f){o({title:"Erro ao atualizar status",description:f.message,variant:"destructive"})}finally{y(null)}},T=t=>{t&&t.profiles?(_(t),C(!0)):o({title:"Erro",description:"Não foi possível carregar o perfil do modelo.",variant:"destructive"})},S=()=>{C(!1),_(null)},E={pending:"bg-yellow-100 text-yellow-700 border-yellow-200",accepted:"bg-green-100 text-green-700 border-green-200",rejected:"bg-red-100 text-red-700 border-red-200"},F=t=>({pending:"Pendente",accepted:"Aceita",rejected:"Recusada"})[t]||t;return a?e.jsxs(e.Fragment,{children:[e.jsx(ee,{open:d&&!w,onOpenChange:v,children:e.jsxs(se,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto p-0",children:[e.jsxs(ae,{className:"p-6 pb-4 border-b",children:[e.jsxs(te,{className:"text-2xl font-bold text-gray-800",children:["Candidatos para: ",a.title]}),e.jsx(le,{children:"Gerencie os modelos que se candidataram para esta vaga."}),e.jsx(re,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:e.jsx(U,{className:"h-5 w-5"})})})]}),e.jsx("div",{className:"p-6",children:g?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx(W,{className:"h-10 w-10 text-pink-500 animate-spin"})}):l.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx(ce,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum candidato para esta vaga ainda."})]}):e.jsx("div",{className:"space-y-4",children:l.map(t=>{var m,f,n,u,D,j;return e.jsx(K,{className:"shadow-md hover:shadow-lg transition-shadow",children:e.jsxs(fe,{className:"p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-pink-100 to-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:(m=t.profiles)!=null&&m.profile_image_url?e.jsx("img",{src:t.profiles.profile_image_url,alt:`Foto de ${t.profiles.name}`,className:"w-full h-full object-cover rounded-full"}):e.jsx(ie,{className:"h-10 w-10 text-pink-500"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:((f=t.profiles)==null?void 0:f.name)||"Nome Indisponível"}),e.jsx(I,{className:`text-xs ${E[t.status]||""}`,children:F(t.status)})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((n=t.profiles)==null?void 0:n.user_type)==="model"?"Modelo":((u=t.profiles)==null?void 0:u.user_type)||"Tipo Indisponível"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1 text-xs",children:[((D=t.profiles)==null?void 0:D.is_verified)&&e.jsxs(I,{variant:"outline",className:"border-blue-500 text-blue-600",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Verificado"]}),((j=t.profiles)==null?void 0:j.subscription_type)&&e.jsxs(I,{variant:"outline",className:"border-yellow-500 text-yellow-600",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),t.profiles.subscription_type]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center",children:[e.jsx(ds,{className:"h-3.5 w-3.5 mr-1.5"})," Candidatou-se em: ",new Date(t.application_date).toLocaleDateString("pt-BR")]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mt-3 sm:mt-0 self-start sm:self-center",children:e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>T(t),className:"w-full sm:w-auto",children:[e.jsx(ge,{className:"h-4 w-4 mr-1.5"})," Analisar"]})})]})},t.id)})})})]})}),N&&e.jsx(gs,{isOpen:w,onClose:S,applicantProfile:N.profiles,application:N,onAccept:t=>A(t,"accepted"),onReject:t=>A(t,"rejected"),isUpdating:b===N.id})]}):null},ys=({job:a,isOpen:d,onClose:v,onApplicationSuccess:x,onEditRequest:o})=>{var m,f;const{user:l,openAuthModal:h}=je(),{toast:g}=ne(),[p,b]=r.useState(!1),[y,w]=r.useState(!1),[C,N]=r.useState(!0),_="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",k=r.useCallback(async()=>{if(!l||!a||l.user_type!=="model"){N(!1),b(!1);return}N(!0);try{const{data:n,error:u}=await M.from("job_applications").select("id").eq("job_id",a.id).eq("model_id",l.id).maybeSingle();if(u&&u.code!=="PGRST116")throw u;b(!!n)}catch(n){console.error("Erro ao verificar candidatura:",n),b(!1)}finally{N(!1)}},[l,a]);if(r.useEffect(()=>{d&&k()},[d,k]),!a)return null;const A=n=>n?new Date(n).toLocaleDateString("pt-BR",{timeZone:"UTC"}):"N/A",T=n=>n?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n):"A Combinar",S=(n,u)=>{const D=n.find(j=>j.value===u);return D?D.label:u},E=async()=>{if(!l){h("login");return}if(l.user_type!=="model"){g({title:"Ação não permitida",description:"Apenas modelos podem se candidatar a vagas.",variant:"destructive"});return}if(p){g({title:"Candidatura já realizada",description:`Você já se candidatou para a vaga "${a.title}".`});return}w(!0);try{const{data:n,error:u}=await M.from("job_applications").insert({job_id:a.id,model_id:l.id,status:"pending"});if(u)throw u;g({title:"Candidatura Enviada!",description:`Você se candidatou para a vaga "${a.title}".`}),b(!0),x&&x()}catch(n){g({title:"Erro ao se candidatar",description:n.message||"Não foi possível enviar sua candidatura. Tente novamente.",variant:"destructive"})}finally{w(!1)}},F=a.job_image_url||_,t=l&&l.id===a.created_by;return e.jsx(ee,{open:d,onOpenChange:v,children:e.jsxs(se,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:F,alt:`Banner da vaga ${a.title}`,className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsxs(ae,{className:"absolute bottom-0 left-0 p-6 w-full",children:[e.jsx(te,{className:"text-3xl font-bold text-white mb-1",style:{textShadow:"1px 1px 3px rgba(0,0,0,0.7)"},children:a.title}),e.jsx(le,{className:"text-gray-200",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:((m=a.profiles)==null?void 0:m.name)||"Empresa Confidencial"})]}),e.jsx(re,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 bg-black/50 text-white hover:bg-black/70 hover:text-white",children:e.jsx(U,{className:"h-5 w-5"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(X,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo de Trabalho"}),e.jsx("p",{className:"font-medium",children:S(ze,a.job_type)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(oe,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Localização"}),e.jsx("p",{className:"font-medium",children:a.job_city&&a.job_state?`${a.job_city}, ${a.job_state}`:a.location||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(ve,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Data do Evento"}),e.jsx("p",{className:"font-medium",children:A(a.event_date)})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(ps,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duração"}),e.jsxs("p",{className:"font-medium",children:[a.duration_days||"N/A"," dia(s)"]})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(ye,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pagamento Diário"}),e.jsx("p",{className:"font-medium",children:T(a.daily_rate)})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(ce,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Modelos Necessários"}),e.jsx("p",{className:"font-medium",children:a.num_models_needed||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center text-gray-700 md:col-span-2",children:[e.jsx(ie,{className:"h-5 w-5 mr-3 text-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Publicado por"}),e.jsx("p",{className:"font-medium",children:((f=a.profiles)==null?void 0:f.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(Be,{className:"h-5 w-5 mr-2 text-pink-600"}),"Descrição da Vaga"]}),e.jsx("p",{className:"text-gray-600 leading-relaxed whitespace-pre-wrap",children:a.description||"Nenhuma descrição fornecida."})]}),(a.required_model_type&&a.required_model_type!=="Indiferente"||a.required_model_profile&&a.required_model_profile!=="Indiferente"||a.specific_requirements)&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(fs,{className:"h-5 w-5 mr-2 text-pink-600"}),"Requisitos"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-600",children:[a.required_model_type&&a.required_model_type!=="Indiferente"&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2 text-gray-500"}),"Tipo de Modelo: ",S(Je,a.required_model_type)]}),a.required_model_profile&&a.required_model_profile!=="Indiferente"&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(Re,{className:"h-4 w-4 mr-2 text-gray-500"}),"Perfil Físico: ",S(Pe,a.required_model_profile)]}),a.specific_requirements&&e.jsx("li",{children:a.specific_requirements})]})]}),e.jsxs("div",{className:"border-t pt-6 flex justify-end items-center gap-3",children:[t&&e.jsxs(i,{variant:"outline",onClick:()=>o(a),children:[e.jsx(ms,{className:"h-4 w-4 mr-2"})," Editar Vaga"]}),l&&l.user_type==="model"&&e.jsx(i,{onClick:E,className:`px-8 py-3 text-base ${p?"bg-green-600 hover:bg-green-700 cursor-not-allowed":"btn-gradient text-white"}`,disabled:p||y||C,children:C?"Verificando...":p?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-5 w-5 mr-2"})," Candidatura Enviada"]}):y?"Enviando...":"Candidatar-se Agora"}),l&&!t&&(l.user_type==="contractor"||l.user_type==="photographer"||l.user_type==="admin")&&e.jsx(i,{variant:"outline",onClick:v,className:"px-8 py-3 text-base",children:"Fechar Detalhes"}),!l&&e.jsx(i,{onClick:()=>h("register"),className:"btn-gradient text-white px-8 py-3 text-base",children:"Cadastre-se para Candidatar"})]})]})]})})},Is=()=>{const{user:a,openAuthModal:d}=je(),v=Ue(),{toast:x}=ne(),[o,l]=r.useState(""),[h,g]=r.useState("all"),[p,b]=r.useState("all"),[y,w]=r.useState([]),[C,N]=r.useState(!0),[_,k]=r.useState(new Set),[A,T]=r.useState(null),[S,E]=r.useState(!1),[F,t]=r.useState(null),[m,f]=r.useState(null),n="https://images.unsplash.com/photo-1505664194779-8be2240422fa?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=60",[u,D]=r.useState(!1),[j,de]=r.useState("recent"),me=[{value:"recent",label:"📅 Mais Recentes"},{value:"oldest",label:"🕰️ Mais Antigas"},{value:"rate_high",label:"💰 Maior Cachê"},{value:"rate_low",label:"💸 Menor Cachê"}],H=r.useCallback(async()=>{N(!0);try{let s=M.from("jobs").select("*, profiles (id, name, email)").eq("status","open");j==="recent"?s=s.order("created_at",{ascending:!1}):j==="oldest"?s=s.order("created_at",{ascending:!0}):j==="rate_high"?s=s.order("daily_rate",{ascending:!1,nullsLast:!0}):j==="rate_low"&&(s=s.order("daily_rate",{ascending:!0,nullsLast:!0})),o&&(s=s.or(`title.ilike.%${o}%,description.ilike.%${o}%,job_city.ilike.%${o}%,job_state.ilike.%${o}%`)),h&&h!=="all"&&(s=s.eq("job_type",h)),p&&p!=="all"&&(s=s.eq("job_state",p));const{data:c,error:q}=await s;if(q)throw q;if(w(c||[]),a&&a.user_type==="model"){const{data:Ee,error:pe}=await M.from("job_applications").select("job_id").eq("model_id",a.id);if(pe)throw pe;k(new Set(Ee.map(Fe=>Fe.job_id)))}}catch(s){s.code!=="SUPABASE_INIT_ERROR"&&x({title:"Erro ao buscar dados",description:s.message,variant:"destructive"}),console.error("Erro em fetchJobsAndApplications:",s),w([])}finally{N(!1)}},[x,o,h,p,a,j]);r.useEffect(()=>{H()},[H]);const we=s=>{t(s),E(!0)},_e=()=>{t(null),E(!1)},ke=async s=>{if(!a){d("login");return}if(a.user_type!=="model"){x({title:"Ação não permitida",description:"Apenas modelos podem se candidatar.",variant:"destructive"});return}if(_.has(s.id)){x({title:"Candidatura já realizada",description:"Você já se candidatou para esta vaga."});return}T(s.id);try{const{error:c}=await M.from("job_applications").insert({job_id:s.id,model_id:a.id,status:"pending"});if(c)throw c;x({title:"Candidatura Enviada!",description:`Você se candidatou para "${s.title}".`}),k(q=>new Set(q).add(s.id))}catch(c){c.code!=="SUPABASE_INIT_ERROR"&&x({title:"Erro ao se candidatar",description:c.message,variant:"destructive"}),console.error("Erro em handleApply:",c)}finally{T(null)}},Ce=()=>{if(!a){d("login");return}if(a.user_type==="model"){x({title:"Ação não permitida",description:"Modelos não publicam vagas.",variant:"destructive"});return}v("/meus-trabalhos")},Ae=()=>{if(!a){d("login");return}x({title:"Ação não permitida",description:"Apenas modelos podem se candidatar a vagas.",variant:"destructive",duration:7e3})},Se=s=>s?new Date(s).toLocaleDateString("pt-BR",{timeZone:"UTC"}):"N/A",De=s=>s!==null&&s>0?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s):"A combinar",Me=s=>{s.target.src!==n&&(s.target.onerror=null,s.target.src=n)},G=(s=!0)=>{l(""),g("all"),b("all"),s&&D(!1)},xe=s=>f(s),Te=()=>f(null),he=({isMobile:s})=>e.jsxs("div",{className:`space-y-4 ${s?"p-1":""}`,children:[e.jsxs("div",{children:[e.jsx(Z,{htmlFor:`job-type-filter-${s?"mobile":"desktop"}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Trabalho"}),e.jsxs($,{value:h,onValueChange:g,children:[e.jsx(V,{id:`job-type-filter-${s?"mobile":"desktop"}`,className:"py-2.5 h-auto",children:e.jsx(z,{placeholder:"Todos os Tipos"})}),e.jsx(B,{children:Ke.map(c=>e.jsx(O,{value:c.value,children:c.label},c.value))})]})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:`location-filter-${s?"mobile":"desktop"}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado (UF)"}),e.jsxs($,{value:p,onValueChange:b,children:[e.jsx(V,{id:`location-filter-${s?"mobile":"desktop"}`,className:"py-2.5 h-auto",children:e.jsx(z,{placeholder:"Todos os Estados"})}),e.jsx(B,{children:ns.map(c=>e.jsx(O,{value:c.value,children:c.label},c.value))})]})]}),s&&e.jsxs(i,{onClick:()=>G(!0),variant:"outline",className:"w-full py-2.5 h-auto",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"})," Limpar Filtros"]})]});return e.jsxs(e.Fragment,{children:[e.jsx(xs,{delayDuration:100,children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-red-50 to-orange-50 py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-800 mb-2 flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left gap-1 sm:gap-2",children:[e.jsx(X,{className:"h-7 w-7 sm:h-8 sm:w-8 text-pink-500"}),e.jsxs("span",{children:[e.jsx("span",{className:"gradient-text",children:"Oportunidades"})," Incríveis"]})]}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600 text-center sm:text-left",children:"Encontre trabalhos perfeitos para seu perfil."})]}),a&&["contractor","photographer","admin"].includes(a.user_type)&&e.jsxs(i,{onClick:Ce,className:"btn-gradient text-white mt-4 lg:mt-0 py-2.5 h-auto",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"})," Publicar Nova Vaga"]})]}),e.jsxs(K,{className:"shadow-xl p-6 mb-8 bg-white/80 backdrop-blur-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg flex-1 w-full md:w-auto",children:[e.jsx(He,{className:"ml-3 text-gray-400 h-5 w-5 flex-shrink-0"}),e.jsx(Ge,{id:"search-term",placeholder:"Título, descrição, cidade...",value:o,onChange:s=>l(s.target.value),className:"pl-2 pr-3 py-3 border-none focus:ring-0 flex-1"})]}),e.jsxs("div",{className:"md:hidden w-full flex gap-2",children:[e.jsxs($,{value:j,onValueChange:de,children:[e.jsx(V,{id:"sortByJobsMobile",className:"w-full py-2.5 h-auto",children:e.jsx(z,{placeholder:"Ordenar por..."})}),e.jsx(B,{children:me.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))})]}),e.jsxs(Xe,{open:u,onOpenChange:D,children:[e.jsx(es,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"flex-1 py-2.5 h-auto",children:[e.jsx(hs,{className:"h-5 w-5 mr-2"})," Filtros"]})}),e.jsxs(ss,{side:"bottom",className:"h-[60vh] flex flex-col",children:[e.jsxs(as,{className:"p-4 border-b",children:[e.jsx(ts,{children:"Filtrar Vagas"}),e.jsx(rs,{children:"Encontre a vaga ideal para você."})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 scrollbar-thin",children:e.jsx(he,{isMobile:!0})}),e.jsxs(ls,{className:"p-4 border-t flex-col sm:flex-row gap-2",children:[e.jsxs(i,{variant:"outline",onClick:()=>G(!0),className:"w-full py-2.5 h-auto",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Limpar"]}),e.jsx(is,{asChild:!0,children:e.jsx(i,{className:"w-full btn-gradient py-2.5 h-auto",children:"Aplicar"})})]})]})]})]})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"sortByJobsDesktop",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordenar Por"}),e.jsxs($,{value:j,onValueChange:de,children:[e.jsx(V,{id:"sortByJobsDesktop",className:"py-2.5 h-auto",children:e.jsx(z,{placeholder:"Ordenar por..."})}),e.jsx(B,{children:me.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))})]})]}),e.jsx(he,{isMobile:!1}),e.jsxs(i,{onClick:()=>G(!1),variant:"outline",className:"w-full lg:w-auto self-end py-2.5 h-auto",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"})," Limpar Filtros"]})]})]}),C?e.jsx("div",{className:"text-center py-12",children:e.jsx(W,{className:"h-16 w-16 text-pink-500 animate-spin mx-auto"})}):y.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl shadow-md",children:[e.jsx(X,{className:"h-20 w-20 text-gray-300 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-gray-800 mb-3",children:"Nenhuma vaga encontrada"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Tente ajustar seus filtros ou volte mais tarde."}),e.jsx(i,{onClick:()=>{l(""),g("all"),b("all")},variant:"outline",className:"text-pink-600 border-pink-600 hover:bg-pink-50 py-2.5 h-auto",children:"Limpar Filtros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:y.length})," oportunidade",y.length!==1&&"s"," encontrada",y.length!==1&&"s","."]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:y.map(s=>{var c;return e.jsxs(K,{className:"flex flex-col justify-between shadow-lg hover:shadow-xl transition-all duration-300 bg-white hover:border-pink-300 border border-transparent animate-fade-in group",children:[e.jsxs(Ze,{className:"pb-3",children:[e.jsx("div",{className:"h-40 mb-3 rounded-t-md overflow-hidden -mx-6 -mt-6",children:e.jsx("img",{src:s.job_image_url||n,onError:Me,alt:`Imagem da vaga ${s.title}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"})}),e.jsx(Ye,{className:"text-xl text-pink-600 hover:text-pink-700 cursor-pointer",onClick:()=>xe(s),children:s.title}),e.jsxs(Qe,{className:"flex items-center text-sm text-gray-500 pt-1",children:[e.jsx(us,{className:"h-4 w-4 mr-1.5 text-gray-400"})," ",((c=s.profiles)==null?void 0:c.name)||"Empresa Confidencial"]})]}),e.jsxs(fe,{className:"flex-grow space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(oe,{size:16,className:"mr-2 text-gray-400"})," ",s.job_city&&s.job_state?`${s.job_city}, ${s.job_state}`:s.location||"Remoto/N/A"]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ve,{size:16,className:"mr-2 text-gray-400"})," ",Se(s.event_date)," (",s.duration_days||1," dia",s.duration_days>1?"s":"",")"]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ye,{size:16,className:"mr-2 text-gray-400"})," ",De(s.daily_rate)]}),e.jsx("p",{className:"text-gray-500 line-clamp-2 pt-1",children:s.description||"Sem descrição detalhada."})]}),e.jsxs(We,{className:"flex items-center justify-end gap-1.5 border-t pt-3 pb-3",children:[e.jsxs(J,{children:[e.jsx(R,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>xe(s),className:"w-8 h-8 hover:bg-pink-100",children:e.jsx(ge,{className:"h-4 w-4 text-pink-600"})})}),e.jsx(P,{children:e.jsx("p",{children:"Ver Detalhes"})})]}),a&&a.id===s.created_by&&e.jsxs(J,{children:[e.jsx(R,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>we(s),className:"w-8 h-8 hover:bg-pink-100",children:e.jsx(ce,{className:"h-4 w-4 text-pink-600"})})}),e.jsx(P,{children:e.jsx("p",{children:"Ver Candidatos"})})]}),a&&a.user_type==="model"&&e.jsxs(J,{children:[e.jsx(R,{asChild:!0,children:e.jsx(i,{onClick:()=>ke(s),variant:"ghost",size:"icon",className:`w-8 h-8 ${_.has(s.id)?"bg-green-100 hover:bg-green-200":"hover:bg-pink-100"}`,disabled:_.has(s.id)||A===s.id,children:A===s.id?e.jsx(W,{className:"h-4 w-4 animate-spin text-pink-600"}):_.has(s.id)?e.jsx(Ne,{className:"h-4 w-4 text-green-600"}):e.jsx(Q,{className:"h-4 w-4 text-pink-600"})})}),e.jsx(P,{children:e.jsx("p",{children:_.has(s.id)?"Concorrendo":A===s.id?"Enviando...":"Candidatar-se"})})]}),(!a||a&&a.user_type!=="model"&&a.id!==s.created_by)&&e.jsxs(J,{children:[e.jsx(R,{asChild:!0,children:e.jsx(i,{onClick:Ae,variant:"ghost",size:"icon",className:"w-8 h-8 hover:bg-pink-100",children:e.jsx(Q,{className:"h-4 w-4 text-pink-600"})})}),e.jsx(P,{children:e.jsx("p",{children:"Candidatar-se"})})]})]})]},s.id)})})]})]})})}),S&&F&&e.jsx(js,{job:F,isOpen:S,onClose:_e,navigate:v}),m&&e.jsx(ys,{job:m,isOpen:!!m,onClose:Te,onApplicationSuccess:H})]})};export{Is as default};
