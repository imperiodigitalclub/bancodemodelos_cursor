# AN√ÅLISE COMPLETA DO SISTEMA BANCO DE MODELOS

## üìã RESUMO EXECUTIVO

O **Banco de Modelos** √© uma plataforma completa de marketplace para modelos, fot√≥grafos e contratantes, desenvolvida em React + Vite com backend Supabase (PostgreSQL). O sistema possui funcionalidades avan√ßadas de autentica√ß√£o, pagamentos, notifica√ß√µes, gest√£o de conte√∫do e administra√ß√£o.

**Status Atual:** Sistema em produ√ß√£o com funcionalidades completas implementadas e testadas.

---

## üèóÔ∏è ARQUITETURA DO SISTEMA

### **Frontend (React + Vite)**
- **Framework**: React 18 com Vite
- **UI**: Tailwind CSS + Shadcn/ui
- **Roteamento**: React Router DOM
- **Estado**: Context API + Hooks customizados
- **Build**: Vite com configura√ß√µes otimizadas
- **Lazy Loading**: Implementado para otimiza√ß√£o de performance

### **Backend (Supabase)**
- **Banco**: PostgreSQL 17.4
- **Autentica√ß√£o**: Supabase Auth com RLS
- **Storage**: Supabase Storage para uploads
- **Edge Functions**: Deno runtime para APIs
- **Realtime**: WebSockets para notifica√ß√µes em tempo real

---

## üóÑÔ∏è ESTRUTURA DO BANCO DE DADOS

### **Schemas Principais**

#### **Schema `public` (Tabelas de Neg√≥cio)**

| Tabela | Descri√ß√£o | Relacionamentos | Status |
|--------|-----------|-----------------|---------|
| `profiles` | Perfis de usu√°rios (modelos, contratantes, admins) | FK: auth.users | ‚úÖ Ativo |
| `jobs` | Vagas de trabalho publicadas | FK: profiles (criador) | ‚úÖ Ativo |
| `job_applications` | Candidaturas para vagas | FK: jobs, profiles | ‚úÖ Ativo |
| `job_contracts` | Contratos fechados | FK: jobs, profiles | ‚úÖ Ativo |
| `reviews` | Avalia√ß√µes de usu√°rios | FK: profiles (avaliador/avaliado) | ‚úÖ Ativo |
| `user_favorites` | Favoritos dos usu√°rios | FK: profiles | ‚úÖ Ativo |
| `profile_photos` | Fotos dos perfis | FK: profiles | ‚úÖ Ativo |
| `profile_videos` | V√≠deos dos perfis | FK: profiles | ‚úÖ Ativo |
| `notifications` | Sistema de notifica√ß√µes | FK: profiles | ‚úÖ Ativo |
| `notification_preferences` | Prefer√™ncias de notifica√ß√£o | FK: profiles | ‚úÖ Ativo |
| `wallet_transactions` | Transa√ß√µes da carteira | FK: profiles | ‚úÖ Ativo |
| `withdrawal_requests` | Solicita√ß√µes de saque | FK: profiles | ‚úÖ Ativo |
| `user_verifications` | Verifica√ß√µes de usu√°rio | FK: profiles | ‚úÖ Ativo |
| `subscriptions` | Assinaturas premium | FK: profiles | ‚úÖ Ativo |
| `user_fcm_tokens` | Tokens para push notifications | FK: profiles | ‚úÖ Ativo |

#### **Schema `auth` (Autentica√ß√£o Supabase)**
- `users` - Usu√°rios do sistema
- `sessions` - Sess√µes ativas
- `identities` - Identidades (Google, etc.)
- `mfa_factors` - Autentica√ß√£o multi-fator
- `audit_log_entries` - Logs de auditoria

#### **Schema `storage` (Arquivos)**
- `buckets` - Buckets de storage
- `objects` - Objetos armazenados
- `migrations` - Migra√ß√µes do storage

#### **Schema `realtime` (Tempo Real)**
- `messages` - Mensagens em tempo real
- `subscription` - Inscri√ß√µes em canais

### **Tabelas de Configura√ß√£o**

| Tabela | Descri√ß√£o | Status |
|--------|-----------|---------|
| `app_settings` | Configura√ß√µes gerais do sistema | ‚úÖ Ativo |
| `email_templates` | Templates de email | ‚úÖ Ativo |
| `email_logs` | Logs de envio de emails | ‚úÖ Ativo |
| `broadcast_logs` | Logs de broadcasts | ‚úÖ Ativo |
| `landing_pages` | P√°ginas de landing | ‚úÖ Ativo |
| `menus` | Configura√ß√£o de menus | ‚úÖ Ativo |
| `pages` | P√°ginas din√¢micas | ‚úÖ Ativo |
| `model_characteristics_options` | Op√ß√µes de caracter√≠sticas | ‚úÖ Ativo |
| `work_interests_options` | Op√ß√µes de interesses | ‚úÖ Ativo |
| `webhook_events` | Eventos de webhook | ‚úÖ Ativo |

---

## üîê SISTEMA DE AUTENTICA√á√ÉO E CADASTRO

### **Fluxo de Registro Completo**
1. **UserTypeStep** - Escolha do tipo (Modelo/Contratante)
2. **AccountDetailsStep** - Email, senha, nome
3. **ProfilePictureStep** - Upload de foto
4. **ModelProfileTypeStep** - Tipo de perfil (se modelo)
5. **ModelPhysicalTypeStep** - Tipo f√≠sico
6. **ModelPhysicalProfileStep** - Dados f√≠sicos (altura, peso, medidas)
7. **ModelCharacteristicsStep** - Caracter√≠sticas (cabelo, olhos, etc.)
8. **ModelInterestsStep** - Interesses de trabalho
9. **ModelAppearanceStep** - Apar√™ncia e estilo
10. **LocationStep** - Localiza√ß√£o (cidade, estado)
11. **InstagramStep** - Instagram
12. **WhatsappStep** - WhatsApp

### **Tipos de Usu√°rio**
- **Modelo** - Perfil completo com caracter√≠sticas f√≠sicas e medidas
- **Contratante** - Perfil simplificado para contratar
- **Fot√≥grafo** - Perfil especializado para fotografia
- **Admin** - Acesso administrativo completo

### **Funcionalidades de Autentica√ß√£o**
- ‚úÖ Login/Logout com Supabase Auth
- ‚úÖ Registro multi-step com valida√ß√£o
- ‚úÖ Upload de foto de perfil
- ‚úÖ Verifica√ß√£o de email
- ‚úÖ Recupera√ß√£o de senha
- ‚úÖ Prote√ß√£o de rotas por tipo de usu√°rio
- ‚úÖ Modal de boas-vindas para novos usu√°rios

---

## üí∞ SISTEMA DE PAGAMENTOS

### **Integra√ß√£o Mercado Pago**
- **Cria√ß√£o de prefer√™ncia** - `create-payment-preference/`
- **Processamento** - `process-payment/`
- **Webhook** - `mp-webhook/` (vers√£o 2.1.0)
- **Verifica√ß√£o de status** - `check_payment_status_mp.sql`

### **Funcionalidades Implementadas**
- ‚úÖ Cria√ß√£o de prefer√™ncias de pagamento
- ‚úÖ Processamento de pagamentos PIX e cart√£o
- ‚úÖ Webhook robusto com valida√ß√£o de assinatura
- ‚úÖ Sistema de idempot√™ncia para evitar duplicatas
- ‚úÖ Logs detalhados de transa√ß√µes
- ‚úÖ Verifica√ß√£o autom√°tica de status
- ‚úÖ Tratamento de erros e fallbacks

### **Carteira Digital**
- **Transa√ß√µes** - `wallet_transactions`
- **Solicita√ß√µes de saque** - `withdrawal_requests`
- **Verifica√ß√µes** - `user_verifications`

### **Assinaturas Premium**
- **Tabela** - `subscriptions`
- **Contexto** - `SmartSubscriptionContext`
- **Hook** - `useSmartSubscription`
- **Sistema Inteligente** - Sincroniza√ß√£o autom√°tica baseada em pagamentos

---

## üéØ SISTEMA DE VAGAS E MATCH

### **Funcionalidades de Vagas**
- ‚úÖ Publica√ß√£o de vagas por contratantes
- ‚úÖ Busca e filtros avan√ßados
- ‚úÖ Candidaturas de modelos
- ‚úÖ Gest√£o de candidatos
- ‚úÖ Sistema de contratos
- ‚úÖ Avalia√ß√µes p√≥s-trabalho
- ‚úÖ Vagas regionais e nacionais

### **Sistema de Match**
- ‚úÖ Separa√ß√£o de vagas por regi√£o
- ‚úÖ Filtros por tipo de trabalho
- ‚úÖ Filtros por caracter√≠sticas f√≠sicas
- ‚úÖ Filtros por interesses
- ‚úÖ Ordena√ß√£o por relev√¢ncia e data
- ‚úÖ Alertas para vagas da regi√£o

### **Fluxo de Trabalho**
1. **Contratante** publica vaga com requisitos espec√≠ficos
2. **Sistema** filtra e apresenta vagas relevantes para modelos
3. **Modelo** se candidata √† vaga
4. **Contratante** avalia candidatos
5. **Sistema** facilita contrata√ß√£o e pagamento
6. **Ambas as partes** avaliam ap√≥s o trabalho

---

## üìß SISTEMA DE EMAILS

### **Configura√ß√£o Multi-Provedor**
- **Resend** - API Key come√ßando com `re_`
- **SendGrid** - API Key come√ßando com `SG.`
- **SMTP Gen√©rico** - Configura√ß√£o manual

### **Templates Dispon√≠veis**
- ‚úÖ Boas-vindas para novos usu√°rios
- ‚úÖ Confirma√ß√£o de email
- ‚úÖ Reset de senha
- ‚úÖ Notifica√ß√µes de vaga
- ‚úÖ Status de pagamento
- ‚úÖ Status de assinatura
- ‚úÖ Broadcasts em massa

### **Funcionalidades**
- ‚úÖ Envio autom√°tico via Edge Functions
- ‚úÖ Logs detalhados de envio
- ‚úÖ Fallback entre provedores
- ‚úÖ Templates din√¢micos
- ‚úÖ Configura√ß√£o via painel admin

---

## üîî SISTEMA DE NOTIFICA√á√ïES

### **Tipos de Notifica√ß√£o**
- **Email** - Via SMTP/Resend/SendGrid
- **Push** - Via FCM tokens
- **In-app** - Via Supabase Realtime

### **Funcionalidades**
- ‚úÖ Notifica√ß√µes em tempo real
- ‚úÖ Contagem de n√£o lidas
- ‚úÖ Marca√ß√£o como lida
- ‚úÖ Prefer√™ncias por tipo
- ‚úÖ Notifica√ß√µes autom√°ticas para:
  - Novas candidaturas
  - Status de pagamento
  - Assinatura ativada/expirada
  - Mensagens recebidas
  - Vagas da regi√£o

### **Hooks Customizados**
- `useNotifications` - Gest√£o completa de notifica√ß√µes
- `useNotificationCount` - Contagem de n√£o lidas
- `useCreateNotification` - Cria√ß√£o de notifica√ß√µes

---

## üîß EDGE FUNCTIONS

### **Fun√ß√µes de Email**
- `send-email/` - Envio via SMTP/Resend/SendGrid
- `send-email-resend/` - Envio espec√≠fico via Resend
- `webhook-email/` - Webhook para emails

### **Fun√ß√µes de Pagamento**
- `create-payment-preference/` - Criar prefer√™ncia Mercado Pago
- `process-payment/` - Processar pagamentos
- `mp-webhook/` - Webhook Mercado Pago (v2.1.0)
- `get-mp-public-key/` - Obter chave p√∫blica MP

### **Fun√ß√µes Administrativas**
- `send-broadcast/` - Enviar broadcasts
- `delete-auth-user/` - Deletar usu√°rio
- `save-app-secrets/` - Salvar segredos
- `generate-fake-jobs/` - Gerar vagas de teste

---

## üé® ESTRUTURA DO FRONTEND

### **Componentes Principais**

#### **Autentica√ß√£o (`src/components/auth/`)**
- `AuthModal.jsx` - Modal de login/registro
- `WelcomeModal.jsx` - Modal de boas-vindas
- `RegistrationLoadingModal.jsx` - Loading do registro
- Steps de registro completos com valida√ß√£o

#### **Dashboard (`src/components/dashboard/`)**
- `DashboardPage.jsx` - P√°gina principal
- `ProfileTab.jsx` - Aba de perfil
- `GalleryTab.jsx` - Aba de galeria
- `ReviewsTab.jsx` - Aba de avalia√ß√µes
- `SettingsTab.jsx` - Aba de configura√ß√µes
- `WalletTab.jsx` - Aba da carteira
- `SubscriptionTab.jsx` - Aba de assinatura
- `NotificationsTab.jsx` - Aba de notifica√ß√µes

#### **P√°ginas (`src/components/pages/`)**
- `HomePage.jsx` - P√°gina inicial
- `ModelsPage.jsx` - Lista de modelos
- `JobsPage.jsx` - Lista de vagas (completa)
- `ProfilePage.jsx` - Perfil p√∫blico
- `ContractorsPage.jsx` - Lista de contratantes
- `FavoritesPage.jsx` - Favoritos

#### **Admin (`src/components/pages/admin/`)**
- `AdminDashboardPage.jsx` - Dashboard admin completo
- Tabs administrativas para todas as funcionalidades

### **Contextos (`src/contexts/`)**
- `AuthContext.jsx` - Contexto de autentica√ß√£o
- `PaymentContext.jsx` - Contexto de pagamentos
- `SmartSubscriptionContext.jsx` - Contexto de assinatura
- `SupabaseAuthContext.jsx` - Contexto Supabase

### **Hooks (`src/hooks/`)**
- `useNotifications.js` - Hook de notifica√ß√µes
- `useSmartSubscription.js` - Hook de assinatura
- `useAsyncState.js` - Hook para estados ass√≠ncronos

---

## üìä RELACIONAMENTOS PRINCIPAIS

### **Profiles (Centro do Sistema)**
```
profiles (1) ‚Üê‚Üí (N) profile_photos
profiles (1) ‚Üê‚Üí (N) profile_videos
profiles (1) ‚Üê‚Üí (N) reviews (como avaliador)
profiles (1) ‚Üê‚Üí (N) reviews (como avaliado)
profiles (1) ‚Üê‚Üí (N) user_favorites
profiles (1) ‚Üê‚Üí (N) wallet_transactions
profiles (1) ‚Üê‚Üí (N) withdrawal_requests
profiles (1) ‚Üê‚Üí (N) notifications
profiles (1) ‚Üê‚Üí (N) job_applications
profiles (1) ‚Üê‚Üí (N) jobs (como criador)
profiles (1) ‚Üê‚Üí (N) subscriptions
```

### **Jobs (Sistema de Vagas)**
```
jobs (1) ‚Üê‚Üí (N) job_applications
jobs (1) ‚Üê‚Üí (N) job_contracts
jobs (N) ‚Üê‚Üí (1) profiles (criador)
```

### **Notifications (Sistema de Notifica√ß√µes)**
```
notifications (N) ‚Üê‚Üí (1) profiles
notification_preferences (1) ‚Üê‚Üí (1) profiles
```

---

## üéØ FUNCIONALIDADES PRINCIPAIS

### **Para Modelos**
- ‚úÖ Perfil completo com caracter√≠sticas f√≠sicas
- ‚úÖ Galeria de fotos e v√≠deos
- ‚úÖ Sistema de avalia√ß√µes
- ‚úÖ Candidatura para vagas
- ‚úÖ Carteira digital
- ‚úÖ Assinatura premium
- ‚úÖ Notifica√ß√µes personalizadas

### **Para Contratantes**
- ‚úÖ Publica√ß√£o de vagas
- ‚úÖ Busca de modelos
- ‚úÖ Sistema de avalia√ß√µes
- ‚úÖ Contrata√ß√£o direta
- ‚úÖ Hist√≥rico de contratos
- ‚úÖ Gest√£o de candidatos

### **Para Administradores**
- ‚úÖ Gest√£o completa de usu√°rios
- ‚úÖ Modera√ß√£o de conte√∫do
- ‚úÖ Configura√ß√µes do sistema
- ‚úÖ Relat√≥rios e analytics
- ‚úÖ Broadcasts em massa
- ‚úÖ Gest√£o de pagamentos
- ‚úÖ Configura√ß√£o de emails

---

## üõ†Ô∏è CONFIGURA√á√ïES T√âCNICAS

### **Vari√°veis de Ambiente**
```env
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
VITE_MERCADO_PAGO_PUBLIC_KEY=
VITE_GOOGLE_MAPS_API_KEY=
```

### **Depend√™ncias Principais**
```json
{
  "react": "^18.2.0",
  "react-router-dom": "^6.8.0",
  "@supabase/supabase-js": "^2.38.0",
  "tailwindcss": "^3.3.0",
  "lucide-react": "^0.263.1",
  "react-hook-form": "^7.45.0",
  "zustand": "^4.4.0"
}
```

### **Scripts Dispon√≠veis**
```json
{
  "dev": "vite",
  "build": "vite build",
  "preview": "vite preview",
  "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0"
}
```

---

## üîç PONTOS DE ATEN√á√ÉO PARA DESENVOLVIMENTO

### **1. Autentica√ß√£o e Autoriza√ß√£o**
- ‚úÖ Sempre verificar `user.id` vs `profile.id`
- ‚úÖ Usar RLS (Row Level Security) do Supabase
- ‚úÖ Verificar roles: `model`, `contractor`, `admin`
- ‚úÖ Prote√ß√£o de rotas implementada

### **2. Upload de Arquivos**
- ‚úÖ Usar Supabase Storage
- ‚úÖ Validar tipos e tamanhos
- ‚úÖ Processar imagens (crop, resize)

### **3. Pagamentos**
- ‚úÖ Sempre verificar status via webhook
- ‚úÖ Implementar fallbacks para falhas
- ‚úÖ Logs detalhados de transa√ß√µes
- ‚úÖ Sistema de idempot√™ncia

### **4. Emails**
- ‚úÖ M√∫ltiplos provedores (Resend, SendGrid, SMTP)
- ‚úÖ Templates din√¢micos
- ‚úÖ Logs de envio
- ‚úÖ Fallback autom√°tico

### **5. Performance**
- ‚úÖ Lazy loading de componentes
- ‚úÖ Otimiza√ß√£o de imagens
- ‚úÖ Cache de dados
- ‚úÖ Pagina√ß√£o implementada

### **6. Seguran√ßa**
- ‚úÖ Valida√ß√£o de entrada
- ‚úÖ Sanitiza√ß√£o de dados
- ‚úÖ Rate limiting
- ‚úÖ RLS implementado

---

## üìù INSTRU√á√ïES PARA O CURSOR

### **Como Usar Esta An√°lise**

1. **Antes de Qualquer Desenvolvimento:**
   - ‚úÖ Ler esta an√°lise completa
   - ‚úÖ Entender os relacionamentos entre tabelas
   - ‚úÖ Verificar as edge functions existentes
   - ‚úÖ Consulte o CHANGELOG.md para hist√≥rico

2. **Ao Implementar Novas Funcionalidades:**
   - ‚úÖ Verificar se j√° existe estrutura similar
   - ‚úÖ Use os padr√µes estabelecidos
   - ‚úÖ Mantenha consist√™ncia com o design system
   - ‚úÖ Implemente logs e tratamento de erros

3. **Ao Modificar Funcionalidades Existentes:**
   - ‚úÖ Verificar impactos em outras partes
   - ‚úÖ Teste relacionamentos de banco
   - ‚úÖ Mantenha compatibilidade com dados existentes
   - ‚úÖ Atualize documenta√ß√£o

4. **Boas Pr√°ticas:**
   - ‚úÖ Sempre use TypeScript quando poss√≠vel
   - ‚úÖ Implemente loading states
   - ‚úÖ Trate erros graciosamente
   - ‚úÖ Mantenha responsividade
   - ‚úÖ Teste em diferentes dispositivos

### **Estrutura de Arquivos Importante**
```
src/
‚îú‚îÄ‚îÄ components/     # Componentes React
‚îú‚îÄ‚îÄ contexts/       # Contextos de estado
‚îú‚îÄ‚îÄ hooks/          # Hooks customizados
‚îú‚îÄ‚îÄ lib/           # Utilit√°rios e clientes
‚îú‚îÄ‚îÄ pages/         # P√°ginas principais
‚îî‚îÄ‚îÄ ui/            # Componentes de UI

supabase/
‚îú‚îÄ‚îÄ functions/     # Edge Functions
‚îú‚îÄ‚îÄ sql/          # Scripts SQL
‚îî‚îÄ‚îÄ config.toml   # Configura√ß√£o Supabase
```

### **Comandos √öteis**
```bash
# Desenvolvimento
npm run dev

# Build
npm run build

# Supabase
supabase --project-ref fgmdqayaqafxutbncypt start
supabase --project-ref fgmdqayaqafxutbncypt functions deploy
supabase --project-ref fgmdqayaqafxutbncypt db reset
```

---

## üéØ CONCLUS√ÉO

O sistema Banco de Modelos √© uma plataforma robusta e bem estruturada, com funcionalidades avan√ßadas de marketplace, pagamentos, notifica√ß√µes e administra√ß√£o. A arquitetura modular permite f√°cil manuten√ß√£o e expans√£o, enquanto as integra√ß√µes com servi√ßos externos garantem confiabilidade e escalabilidade.

**Principais Pontos Fortes:**
- ‚úÖ Arquitetura bem estruturada
- ‚úÖ Sistema de autentica√ß√£o robusto
- ‚úÖ Integra√ß√£o com m√∫ltiplos provedores
- ‚úÖ Interface responsiva e moderna
- ‚úÖ Sistema de notifica√ß√µes completo
- ‚úÖ Administra√ß√£o avan√ßada
- ‚úÖ Sistema de pagamentos confi√°vel
- ‚úÖ Match inteligente entre vagas e modelos

**√Åreas de Aten√ß√£o:**
- Manter consist√™ncia de dados
- Otimizar performance
- Implementar testes automatizados
- Manter documenta√ß√£o atualizada 

**Status do Sistema:** ‚úÖ PRODU√á√ÉO - Funcionando com todas as funcionalidades principais implementadas e testadas. 